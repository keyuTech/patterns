# å•ä¾‹æ¨¡å¼/Singleton Pattern
> ã€Œå‰ç«¯è®¾è®¡æ¨¡å¼ã€ç³»åˆ—æ˜¯å¯¹äºÂ [patterns.dev](https://www.patterns.dev/) ä¸€ä¹¦çš„ä¸€ç³»åˆ—å­¦ä¹ ç¬”è®°
    
## æ˜¯ä»€ä¹ˆ

> Share a single global instance throughout our application
    
ğŸ‘†åœ¨**æ•´ä¸ªåº”ç”¨**ä¸­å…±äº«**ä¸€ä¸ªå…¨å±€å®ä¾‹**

å•ä¾‹æ˜¯å¯ä»¥å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå¹¶ä¸”å¯ä»¥å…¨å±€è®¿é—®çš„ç±»ï¼Œéå¸¸é€‚åˆç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å…¨å±€çŠ¶æ€ã€‚

## æ€ä¹ˆåš

é¦–å…ˆï¼ŒæŒ‰ç…§ä¸Šæ–‡çš„å®šä¹‰ï¼Œå•ä¾‹åº”è¯¥æ˜¯ä¸€ä¸ªç±»ï¼Œå› æ­¤å…ˆå®šä¹‰ Counter ä½œä¸ºåŸºç¡€ï¼ŒCounterç±»ä¸­å®šä¹‰äº†å››ä¸ªç›¸å…³æ–¹æ³•ï¼šgetInstanceæ–¹æ³•ç”¨äºè·å–å½“å‰å®ä¾‹ï¼›getCountæ–¹æ³•ç”¨äºè·å–è®¡æ•°ï¼›incrementæ–¹æ³•ç”¨äºå¢åŠ è®¡æ•°ï¼›decrementæ–¹æ³•ç”¨äºå‡å°‘è®¡æ•°ã€‚

```jsx
let count = 0;

class Counter {
	getInstance() {
		return this;
	}
	getCount() {
		return count;
	}
	increment() {
		return ++count;
	}
	decrement() {
		return --count;
	}
}
```

ä½†æ˜¯ä¸Šè¿°ä»£ç å¹¶ä¸æ˜¯ä¸€ä¸ªå•ä¾‹æ¨¡å¼ï¼Œå› ä¸ºæŒ‰ç…§å®šä¹‰ï¼Œå•ä¾‹åªèƒ½å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œè€Œä¸Šä¾‹ä¸­çš„ä»£ç å¯ä»¥å¤šæ¬¡å®ä¾‹åŒ–ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åšä¸€äº›æ”¹è¿›ã€‚

```jsx
let count = 0;
let instance;

class Counter {
	constructor() {
		if (instance) {
			throw new Error('only one instance!')
		}
		instance = this
	}
	getInstance() {
		return this;
	}
	getCount() {
		return count;
	}
	increment() {
		return ++count;
	}
	decrement() {
		return --count;
	}
}

const singleton = Object.freeze(new Counter());

export default singleton;
```

è¿™é‡Œåšäº†ä¸¤å¤„æ”¹è¿›ï¼š

é¦–å…ˆï¼Œæ–°å¢äº†instanceå˜é‡ç”¨äºæ ‡è®°ç±»æ˜¯å¦å·²ç»è¢«å®ä¾‹åŒ–ï¼Œåœ¨constructorå‡½æ•°ä¸­å…ˆåˆ¤æ–­instanceæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™æŠ›å‡ºé”™è¯¯ä»¥ä¿è¯åªèƒ½å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¯´æ˜ç±»æœªè¢«å®ä¾‹åŒ–ï¼Œç”¨thisç»™instanceèµ‹å€¼ã€‚

å…¶æ¬¡ï¼Œå¯¹äºå•ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯å•ä¾‹ä¸­çš„å±æ€§åº”è¯¥æ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œå› æ­¤ä½¿ç”¨Object.freeze()æ–¹æ³•å°†singletonå†»ç»“ï¼Œéšåexportå¯¹è±¡singletonã€‚

è¿™æ ·ä¸€æ¥å°±å®ç°äº†Counterç±»çš„ä¸€ä¸ªå±æ€§å›ºå®šçš„å•ä¾‹singletonã€‚

## ä¼˜/ç¼ºç‚¹

å¯¹äºå•ä¾‹æ¥è¯´ï¼Œä¼˜ç‚¹æ˜¯å¯ä»¥ä¸ç”¨æ¯æ¬¡éƒ½ä¸ºå®ä¾‹åŒ–åˆ†é…å†…å­˜ï¼Œå› ä¸ºæ•´ä¸ªåº”ç”¨ä¸­åªä¼šæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥ä¼šèŠ‚çœå¤§é‡å†…å­˜ã€‚

ç”±äºåœ¨C/Javaè¿™äº›è¯­è¨€ä¸­å¹¶ä¸èƒ½ç›´æ¥åˆ›å»ºå¯¹è±¡ï¼Œæ‰€ä»¥é€‚åˆä½¿ç”¨å•ä¾‹æ¥èŠ‚çœå†…å­˜ï¼Œä½†æ˜¯å¯¹äºJavaScriptæ¥è¯´ï¼Œå•ä¾‹æ¨¡å¼å¹¶ä¸é€‚åˆï¼Œå› ä¸ºJavaScriptä¸­å¯ä»¥ç›´æ¥åˆ›å»ºå¯¹è±¡ï¼Œå¯ä»¥ç”¨æ›´åŠ æ–¹ä¾¿çš„æ–¹å¼å®ç°å•ä¾‹çš„æ•ˆæœï¼Œæ‰€ä»¥åœ¨JavaScriptä¸­ä¼šé¿å…ä½¿ç”¨å•ä¾‹ã€‚

ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¯ä»¥ç®€å•å®ç°å•ä¾‹çš„æ•ˆæœï¼š

```jsx
let count = 0;

const counter = {
  increment() {
    return ++count;
  },
  decrement() {
    return --count;
  }
};

Object.freeze(counter);
export { counter };
```

å•ä¾‹çš„å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯å¯¹æµ‹è¯•ä¸å‹å¥½ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æµ‹è¯•incrementæ–¹æ³•å’Œdecrementæ–¹æ³•ï¼Œç”±äºåœ¨æ•´ä¸ªåº”ç”¨ä¸­åªæœ‰ä¸€ä¸ªCounterå®ä¾‹ï¼Œåœ¨æµ‹è¯•incrementæ—¶å°†countå¢åŠ è‡³4ï¼Œé‚£ä¹ˆåœ¨æµ‹è¯•decrementæ—¶countçš„èµ·å§‹çŠ¶æ€å°±æ˜¯4è€Œä¸æ˜¯0ï¼Œè¿™ä¼šé€ æˆä¸€äº›é¢„æœŸå¤–çš„æµ‹è¯•ç»“æœã€‚